### Инструкция по запуску

```docker compose up --build```

# URL Shortener API

Это API для сокращения ссылок с возможностью создания, обновления и удаления 
API поддерживает аутентификацию пользователей и позволяет сохранять ссылки, привязанные к конкретным пользователям.

## Описание API

### Основные возможности

- **Создание сокращённой ссылки**
  - Создание ссылки с возможностью указания собственного alias (custom_alias).
  - Проверка на существование уже созданной ссылки для данного пользователя.
  - Сохранение ссылки в базе данных и кэширование в Redis с установленным временем жизни (TTL).

- **Редирект по сокращённой ссылке**
  - Получение оригинального URL по сокращённой ссылке через кэш Redis или запрос к базе данных.
  - Обновление статистики переходов (количество переходов, время последнего редиректа).

- **Удаление ссылки**
  - Удаление ссылки из базы данных и кэша Redis.
  - Доступно только авторизованным пользователям, создавшим ссылку.

- **Обновление ссылки**
  - Обновление оригинального URL сокращённой ссылки.
  - Синхронизация изменений с кэшем Redis.

- **Получение статистики ссылки**
  - Возвращение статистики по ссылке (количество переходов, время последнего редиректа и т.д.) для авторизованного пользователя.

## Описание Таблиц

Таблица users

    id: Целочисленный идентификатор пользователя (primary key).

    username: Уникальное имя пользователя.

    hashed_password: Хэшированный пароль пользователя.

Таблица links

    id: Целочисленный идентификатор ссылки (primary key).

    original_url: Оригинальный URL, который необходимо сократить.

    short_code: Уникальный код сокращённой ссылки.

    created_at: Время создания ссылки (с серверным значением по умолчанию).

    expires_at: Дата и время истечения срока действия ссылки (опционально).

    user_id: Внешний ключ, связывающий ссылку с пользователем (опционально).

    hit_count: Счётчик переходов по ссылке.

    last_accessed_at: Время последнего доступа к ссылке (опционально).

## Тесты
``` python3.10 -m venv .venv```

```source .venv/bin/activate```

```pip install -r requirements.txt```

```coverage run -m pytest tests/```

```coverage report -m```

| Module/File               | Stmts | Miss | Cover | Missing               |
|---------------------------|-------|------|-------|-----------------------|
| api/auth/dependencies.py  | 11    | 1    | 91%   | 12                   |
| api/auth/router.py         | 31    | 0    | 100%  |                       |
| api/auth/schema.py         | 9     | 0    | 100%  |                       |
| api/auth/token.py          | 15    | 0    | 100%  |                       |
| api/auth/users.py          | 40    | 17   | 58%   | 34-49, 56-66         |
| api/cache.py               | 4     | 1    | 75%   | 5                    |
| api/config.py              | 14    | 0    | 100%  |                       |
| api/db.py                  | 13    | 4    | 69%   | 12-16                |
| api/functions.py           | 8     | 0    | 100%  |                       |
| api/links/router.py        | 85    | 13   | 85%   | 83-94, 106, 125, 133-134 |
| api/main.py                | 26    | 11   | 58%   | 16-27                |
| api/models.py              | 18    | 0    | 100%  |                       |
| api/schema.py              | 28    | 0    | 100%  |                       |
| api/utils.py               | 13    | 1    | 92%   | 15                   |
| tests/conftest.py          | 52    | 0    | 100%  |                       |
| tests/test_auth.py         | 25    | 0    | 100%  |                       |
| tests/test_links.py        | 66    | 0    | 100%  |                       |
| **TOTAL**                  | 458   | 48   | 90%   |                       |

